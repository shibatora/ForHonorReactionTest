function main(){null!=axisX?null!=axisY?null!=gbButton?(axisX&&axisY&&gbButton&&hideMessage(),paused?showPaused():(defense=getDefense(),showGuard(),timer||setTimer(),performance.now()>timer&&!attack&&(attack=getAttack(),reaction=performance.now()),attack&&defense==attack&&(timings.push({time:performance.now()-reaction,type:attack}),updateStats(),attack=null,timer=null))):setGbButton():setAxisY():setAxisX()}function loop(){navigator.getGamepads&&(gamepad=navigator.getGamepads()[0],delta>tick&&(main(),t0=performance.now()),delta=performance.now()-t0,requestAnimationFrame(loop))}function getAttack(){switch(Math.floor(4*Math.random())){case 0:return"top";case 1:return"right";case 2:return"left";case 3:return"guardbreak";default:return"neutral"}}function getDefense(){if(gamepad){if(gamepad.buttons[gbButton].pressed)return"guardbreak";if(getDistance()>deadzone){if(getAngle()>180-angleTop/2||getAngle()<angleTop/2-180)return"top";if(getAngle()>180-angleTop/2-angleSide&&getAngle()<180-angleTop/2)return"right";if(getAngle()<angleTop/2-180+angleSide&&getAngle()>angleTop/2-180)return"left"}}}function showGuard(){document.getElementById("attack-top").style.fill="#404040",document.getElementById("attack-right").style.fill="#404040",document.getElementById("attack-left").style.fill="#404040",document.getElementById("attack-guardbreak").style.fill="#404040",(attack||defense)&&(attack&&defense&&attack==defense&&(document.getElementById(`attack-${attack}`).style.fill="#ff8040"),attack&&(document.getElementById(`attack-${attack}`).style.fill="#ff4000"),defense&&(document.getElementById(`attack-${defense}`).style.fill="#c0c0c0"))}function setTimer(){timer=performance.now()+Math.floor(Math.random()*(maxTimerMs-minTimerMs)+minTimerMs)}function getDistance(){if(!gamepad||null==axisX||null==axisY)return;let e=parseFloat(gamepad.axes[axisX]),t=parseFloat(gamepad.axes[axisY]);return Math.sqrt(Math.pow(e,2)+Math.pow(t,2)).toFixed(2)}function getAngle(){if(!gamepad||null==axisX||null==axisY)return;let e=parseFloat(gamepad.axes[axisX]),t=parseFloat(gamepad.axes[axisY]);return(Math.atan2(e,t)*(180/Math.PI)).toFixed(2)}function setConfigs(){deadzone=document.getElementById("config-deadzone").value/100,angleTop=document.getElementById("config-top").value,angleBottom=document.getElementById("config-bottom").value,deadzone<0?(deadzone=0,document.getElementById("config-deadzone").value=0):deadzone>20&&(deadzone=20,document.getElementById("config-deadzone").value=20),angleTop<5?(angleTop=5,document.getElementById("config-top").value=5):angleTop>170&&(angleTop=170,document.getElementById("config-top").value=170),angleBottom<5?(angleTop=5,document.getElementById("config-bottom").value=5):angleBottom>130&&(angleTop=130,document.getElementById("config-bottom").value=130),angleSide=(360-angleTop-angleBottom-60)/2}function setGbButton(){if(gamepad){paused=!0,gbButton=null,showMessage("Press guard break button now to configure.");for(let e=0;e<gamepad.buttons.length;e++)if(gamepad.buttons[e].pressed)return gbButton=e,hideMessage(),void console.log(`Guardbreak set to button: ${gbButton}`)}}function setAxisX(){if(gamepad&&!(Math.abs(gamepad.axes[axisY])>.2)){paused=!0,axisX=null,showMessage("Move stick along the x-axis now to configure.");for(let e=0;e<gamepad.axes.length;e++)if(Math.abs(gamepad.axes[e])>.5)return axisX=e,hideMessage(),timeout=performance.now(),void console.log(`X axis set to axis: ${axisX}`)}}function setAxisY(){if(gamepad&&!(Math.abs(gamepad.axes[axisX])>.2)){paused=!0,axisY=null,showMessage("Move stick along the y-axis now to configure.");for(let e=0;e<gamepad.axes.length;e++)if(Math.abs(gamepad.axes[e])>.5)return axisY=e,hideMessage(),timeout=performance.now(),void console.log(`Y axis set to axis: ${axisY}`)}}function showMessage(e){let t=document.getElementById("message");"block"!=t.style.display&&(t.innerText=e,t.style.display="block")}function showPaused(){let e=document.getElementById("paused");"block"!=e.style.display&&gbButton&&axisX&&axisY&&(e.style.display="block")}function hideMessage(){let e=document.getElementById("message");"none"!=e.style.display&&(e.style.display="none")}function hidePaused(){let e=document.getElementById("paused");"none"!=e.style.display&&(e.style.display="none")}function updateStats(){if(!(timings.length>0))return;let e,t,a=document.getElementById("stats");e=`<pre>Attempts (all) <span>....................</span> : ${timings.length}</pre>`,e+=`<pre>Faster than 400 ms (all) <span>..........</span> : ${timings.map(e=>e.time).filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (all) <span>..........</span> : ${timings.map(e=>e.time).filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (all) <span>..........</span> : ${timings.map(e=>e.time).filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (all) <span>.......</span> : ${(timings.map(e=>e.time).reduce((e,t)=>e+t)/timings.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (all) <span>.......</span> : ${t=timings.length%2==0?((timings.map(e=>e.time).sort()[timings.length/2-1]+timings.map(e=>e.time).sort()[timings.length/2])/2).toFixed(2):timings.map(e=>e.time).sort()[(timings.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (all) <span>.......</span> : ${Math.min(...timings.map(e=>e.time)).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (all) <span>.......</span> : ${Math.max(...timings.map(e=>e.time)).toFixed(2)} ms</pre>`,e+="</br>";let n=timings.filter(e=>"top"==e.type).map(e=>e.time),s=timings.filter(e=>"right"==e.type).map(e=>e.time),r=timings.filter(e=>"left"==e.type).map(e=>e.time),p=timings.filter(e=>"guardbreak"==e.type).map(e=>e.time);if(n.length>0){let t;e+=`<pre>Attempts (top) <span>....................</span> : ${n.length}</pre>`,e+=`<pre>Faster than 400 ms (top) <span>..........</span> : ${n.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (top) <span>..........</span> : ${n.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (top) <span>..........</span> : ${n.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (top) <span>.......</span> : ${(n.reduce((e,t)=>e+t)/n.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (top) <span>.......</span> : ${t=n.length%2==0?((n.sort()[n.length/2-1]+n.sort()[n.length/2])/2).toFixed(2):n.sort()[(n.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (top) <span>.......</span> : ${Math.min(...n).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (top) <span>.......</span> : ${Math.max(...n).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (top) <span>....................</span> :</pre>",e+="<pre>Faster than 400 ms (top) <span>..........</span> :</pre>",e+="<pre>Faster than 500 ms (top) <span>..........</span> :</pre>",e+="<pre>Faster than 600 ms (top) <span>..........</span> :</pre>",e+="<pre>Average reaction time (top) <span>.......</span> :</pre>",e+="<pre>Median  reaction time (top) <span>.......</span> :</pre>",e+="<pre>Fastest reaction time (top) <span>.......</span> :</pre>",e+="<pre>Slowest reaction time (top) <span>.......</span> :</pre>";if(e+="</br>",s.length>0){let t;e+=`<pre>Attempts (right) <span>..................</span> : ${s.length}</pre>`,e+=`<pre>Faster than 400 ms (right) <span>........</span> : ${s.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (right) <span>........</span> : ${s.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (right) <span>........</span> : ${s.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (right) <span>.....</span> : ${(s.reduce((e,t)=>e+t)/s.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (right) <span>.....</span> : ${t=s.length%2==0?((s.sort()[s.length/2-1]+s.sort()[s.length/2])/2).toFixed(2):s.sort()[(s.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (right) <span>.....</span> : ${Math.min(...s).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (right) <span>.....</span> : ${Math.max(...s).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (right) <span>..................</span> :</pre>",e+="<pre>Faster than 400 ms (right) <span>........</span> :</pre>",e+="<pre>Faster than 500 ms (right) <span>........</span> :</pre>",e+="<pre>Faster than 600 ms (right) <span>........</span> :</pre>",e+="<pre>Average reaction time (right) <span>.....</span> :</pre>",e+="<pre>Median  reaction time (right) <span>.....</span> :</pre>",e+="<pre>Fastest reaction time (right) <span>.....</span> :</pre>",e+="<pre>Slowest reaction time (right) <span>.....</span> :</pre>";if(e+="</br>",r.length>0){let t;e+=`<pre>Attempts (left) <span>...................</span> : ${r.length}</pre>`,e+=`<pre>Faster than 400 ms (left) <span>.........</span> : ${r.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (left) <span>.........</span> : ${r.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (left) <span>.........</span> : ${r.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (left) <span>......</span> : ${(r.reduce((e,t)=>e+t)/r.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (left) <span>......</span> : ${t=r.length%2==0?((r.sort()[r.length/2-1]+r.sort()[r.length/2])/2).toFixed(2):r.sort()[(r.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (left) <span>......</span> : ${Math.min(...r).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (left) <span>......</span> : ${Math.max(...r).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (left) <span>...................</span> :</pre>",e+="<pre>Faster than 400 ms (left) <span>.........</span> :</pre>",e+="<pre>Faster than 500 ms (left) <span>.........</span> :</pre>",e+="<pre>Faster than 600 ms (left) <span>.........</span> :</pre>",e+="<pre>Average reaction time (left) <span>......</span> :</pre>",e+="<pre>Median  reaction time (left) <span>......</span> :</pre>",e+="<pre>Fastest reaction time (left) <span>......</span> :</pre>",e+="<pre>Slowest reaction time (left) <span>......</span> :</pre>";if(e+="</br>",p.length>0){let t;e+=`<pre>Attempts (guard break) <span>............</span> : ${p.length}</pre>`,e+=`<pre>Faster than 400 ms (guard break) <span>..</span> : ${p.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (guard break) <span>..</span> : ${p.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (guard break) <span>..</span> : ${p.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (guard break) : ${(p.reduce((e,t)=>e+t)/p.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (guard break) : ${t=p.length%2==0?((p.sort()[p.length/2-1]+p.sort()[p.length/2])/2).toFixed(2):p.sort()[(p.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (guard break) : ${Math.min(...p).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (guard break) : ${Math.max(...p).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (guard break) <span>............</span> :</pre>",e+="<pre>Faster than 400 ms (guard break) <span>..</span> :</pre>",e+="<pre>Faster than 500 ms (guard break) <span>..</span> :</pre>",e+="<pre>Faster than 600 ms (guard break) <span>..</span> :</pre>",e+="<pre>Average reaction time (guard break) :</pre>",e+="<pre>Median  reaction time (guard break) :</pre>",e+="<pre>Fastest reaction time (guard break) :</pre>",e+="<pre>Slowest reaction time (guard break) :</pre>";a.innerHTML=e}function start(){null!=gbButton&&null!=axisX&&null!=axisY?(setConfigs(),hidePaused(),paused=!1):showMessage("You need to configure your gamepad first.")}function resetInputs(){gbButton=null,axisX=null,axisY=null}const tick=1e3/60;let delta,t0,gamepad,gbButton,axisX,axisY,angleTop,angleBottom,angleSide,deadzone,paused=!1,timeout=0;const minTimerMs=400,maxTimerMs=5e3;let timer,reaction,attack,defense,timings=[],messages=[];window.addEventListener("gamepadconnected",e=>{console.log(`${e.gamepad.id} connected!`),delta=0,t0=performance.now(),requestAnimationFrame(loop),paused=!0}),window.addEventListener("gamepaddisconnected",e=>{console.log(`${e.gamepad.id} disconnected!`)});