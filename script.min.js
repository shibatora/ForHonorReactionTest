function main(){null!==input&&void 0!==input?"gamepad"!==input||null!==axisX&&void 0!==axisX?"gamepad"!==input||null!==axisY&&void 0!==axisY?null!==gbButton&&void 0!==gbButton?(("gamepad"===input&&axisX&&axisY||"mouse"===input)&&gbButton&&hideMessage(),paused?showPaused():(defense=getDefense(),showGuard(),null!==timer&&void 0!==timer||setTimer(),performance.now()>timer&&(null===attack||void 0===attack)&&(attack=getAttack(),reaction=performance.now()),attack&&defense===attack&&(timings.push({time:performance.now()-reaction,type:attack}),updateStats(),attack=null,timer=null))):setGbButton():setAxisY():setAxisX():showInputSelect()}function loop(){("gamepad"!==input||navigator.getGamepads)&&("gamepad"===input&&(gamepad=navigator.getGamepads()[0]),delta>tick&&(main(),t0=performance.now()),delta=performance.now()-t0,requestAnimationFrame(loop))}function getAttack(){switch(Math.floor(4*Math.random())){case 0:return"top";case 1:return"right";case 2:return"left";case 3:return"guardbreak";default:return"neutral"}}function getDefense(){if("gamepad"!==input||null!==gamepad&&void 0!==gamepad){if("gamepad"===input&&gamepad.buttons[gbButton].pressed)return"guardbreak";if("mouse"===input&&key===gbButton)return"guardbreak";if("gamepad"===input){if(getDistance()>deadzoneGamepad){if(getAngle()>180-angleTop/2||getAngle()<angleTop/2-180)return"top";if(getAngle()>180-angleTop/2-angleSide&&getAngle()<180-angleTop/2)return"right";if(getAngle()<angleTop/2-180+angleSide&&getAngle()>angleTop/2-180)return"left"}}else{if(getDistance()>deadzoneUp&&(getAngle()>180-angleTop/2||getAngle()<angleTop/2-180))return"top";if(getDistance()>deadzoneSide&&getAngle()>deadzoneBottom/2&&getAngle()<180-angleTop/2)return"right";if(getDistance()>deadzoneSide&&getAngle()<-deadzoneBottom/2&&getAngle()>angleTop/2-180)return"left"}}}function showGuard(){document.getElementById("attack-top").style.fill="#404040",document.getElementById("attack-right").style.fill="#404040",document.getElementById("attack-left").style.fill="#404040",document.getElementById("attack-guardbreak").style.fill="#404040",(null!==attack&&void 0!==attack||null!==defense&&void 0!==defense)&&(attack&&defense&&attack===defense&&(document.getElementById(`attack-${attack}`).style.fill="#ff8040"),attack&&(document.getElementById(`attack-${attack}`).style.fill="#ff4000"),defense&&(document.getElementById(`attack-${defense}`).style.fill="#c0c0c0"))}function setTimer(){timer=performance.now()+Math.floor(Math.random()*(maxTimerMs-minTimerMs)+minTimerMs)}function getDistance(){if("gamepad"===input&&(null===gamepad||void 0===gamepad||null===axisX||void 0===axisX||null===axisY||void 0===axisY))return;let e,t;return"gamepad"===input?(e=parseFloat(gamepad.axes[axisX]),t=parseFloat(gamepad.axes[axisY])):(e=mouseX,t=mouseY),Math.sqrt(Math.pow(e,2)+Math.pow(t,2)).toFixed(2)}function getAngle(){if("gamepad"===input&&(null===gamepad||void 0===gamepad||null===axisX||void 0===axisY||null===axisY||void 0===axisY))return;let e,t;return"gamepad"===input?(e=parseFloat(gamepad.axes[axisX]),t=parseFloat(gamepad.axes[axisY])):(e=mouseX,t=mouseY),(Math.atan2(e,t)*(180/Math.PI)).toFixed(2)}function setConfigs(){"gamepad"==input?(deadzoneGamepad=document.getElementById("config-deadzone").value/100,angleBottom=document.getElementById("config-bottom").value,(angleTop=document.getElementById("config-top").value)<5?(angleTop=5,document.getElementById("config-top").value=5):angleTop>170&&(angleTop=170,document.getElementById("config-top").value=170),deadzoneGamepad<0?(deadzoneGamepad=0,document.getElementById("config-deadzone").value=0):deadzoneGamepad>20&&(deadzoneGamepad=20,document.getElementById("config-deadzone").value=20),angleBottom<5?(angleTop=5,document.getElementById("config-bottom").value=5):angleBottom>130&&(angleTop=130,document.getElementById("config-bottom").value=130),angleSide=(360-angleTop-angleBottom-60)/2):(deadzoneUp=20-document.getElementById("config-deadzone-up").value,deadzoneSide=20-document.getElementById("config-deadzone-side").value,deadzoneBottom=document.getElementById("config-deadzone-bottom").value,(angleTop=document.getElementById("config-top").value)<5?(angleTop=5,document.getElementById("config-top").value=5):angleTop>170&&(angleTop=170,document.getElementById("config-top").value=170),deadzoneSide<0?(deadzoneSide=20,document.getElementById("config-deadzone-side").value=0):deadzoneSide>20&&(deadzoneSide=0,document.getElementById("config-deadzone-side").value=20),deadzoneUp<0?(deadzoneUp=20,document.getElementById("config-deadzone-up").value=0):deadzoneUp>20&&(deadzoneUp=0,document.getElementById("config-deadzone-up").value=20),deadzoneBottom<0?(deadzoneBottom=0,document.getElementById("config-deadzone-bottom").value=0):deadzoneBottom>100&&(deadzoneBottom=100,document.getElementById("config-deadzone-bottom").value=100))}function setInputConfigOptions(){if(null===input||void 0===input)return void console.log("Error: Could not load input choice.");let e=document.getElementById("config");e.innerHTML="<button onclick='start()'>Start</button>",e.innerHTML+="<button onclick='resetInputs()'>Reset button configuration</button>","gamepad"===input?(e.innerHTML+="<label for='config-top'>Guard up stance angle:</label><input onchange='setConfigs()' id='config-top' type='number' value='135'>",e.innerHTML+="<label for='config-bottom'>Full block / hidden stance angle:</label><input onchange='setConfigs()' id='config-bottom' type='number' value='30'>",e.innerHTML+="<label for='config-deadzone'>Guard mode dead zone:</label><input onchange='setConfigs()' id='config-deadzone' type='number' value='20'>"):(e.innerHTML+="<label for='config-top'>Guard up stance angle:</label><input onchange='setConfigs()' id='config-top' type='number' value='120'>",e.innerHTML+="<label for='config-deadzone-bottom'>Down dead zone angle:</label><input onchange='setConfigs()' id='config-deadzone-bottom' type='number' value='30'>",e.innerHTML+="<label for='config-deadzone-up'>Guard mode sensitivity (up):</label><input onchange='setConfigs()' id='config-deadzone-up' type='number' value='10'>",e.innerHTML+="<label for='config-deadzone-side'>Guard mode sensitivity (down):</label><input onchange='setConfigs()' id='config-deadzone-side' type='number' value='10'>")}function setGbButton(){if("gamepad"!==input||null!==gamepad&&void 0!==gamepad)if(paused=!0,gbButton=null,showMessage("Press guard break button now to configure."),"gamepad"===input){for(let e=0;e<gamepad.buttons.length;e++)if(gamepad.buttons[e].pressed)return gbButton=e,hideMessage(),void console.log(`Guardbreak set to button: ${gbButton}`)}else if(null!==key&&void 0!==key)return gbButton=key,hideMessage(),void console.log(`Guardbreak set to button: ${gbButton}`)}function setAxisX(){if(!(null===gamepad||void 0===gamepad||Math.abs(gamepad.axes[axisY])>.2)){paused=!0,axisX=null,showMessage("Move stick along the x-axis now to configure.");for(let e=0;e<gamepad.axes.length;e++)if(Math.abs(gamepad.axes[e])>.5)return axisX=e,hideMessage(),void console.log(`X axis set to axis: ${axisX}`)}}function setAxisY(){if(!(null===gamepad||void 0===gamepad||Math.abs(gamepad.axes[axisX])>.2)){paused=!0,axisY=null,showMessage("Move stick along the y-axis now to configure.");for(let e=0;e<gamepad.axes.length;e++)if(Math.abs(gamepad.axes[e])>.5)return axisY=e,hideMessage(),void console.log(`Y axis set to axis: ${axisY}`)}}function showMessage(e){let t=document.getElementById("message");"block"!==t.style.display&&(t.innerText=e,t.style.display="block")}function showPaused(){let e=document.getElementById("paused");"block"!==e.style.display&&null!==gbButton&&void 0!==gbButton&&("gamepad"!==input||null!==axisX&&void 0!==axisX&&null!==axisY&&void 0!==axisY)&&(e.style.display="block")}function hideMessage(){let e=document.getElementById("message");"none"!==e.style.display&&(e.style.display="none")}function hidePaused(){let e=document.getElementById("paused");"none"!==e.style.display&&(e.style.display="none")}function updateStats(){if(!(timings.length>0))return;let e,t,n=document.getElementById("stats");e=`<pre>Attempts (all) <span>....................</span> : ${timings.length}</pre>`,e+=`<pre>Faster than 400 ms (all) <span>..........</span> : ${timings.map(e=>e.time).filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (all) <span>..........</span> : ${timings.map(e=>e.time).filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (all) <span>..........</span> : ${timings.map(e=>e.time).filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (all) <span>.......</span> : ${(timings.map(e=>e.time).reduce((e,t)=>e+t)/timings.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (all) <span>.......</span> : ${t=timings.length%2==0?((timings.map(e=>e.time).sort()[timings.length/2-1]+timings.map(e=>e.time).sort()[timings.length/2])/2).toFixed(2):timings.map(e=>e.time).sort()[(timings.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (all) <span>.......</span> : ${Math.min(...timings.map(e=>e.time)).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (all) <span>.......</span> : ${Math.max(...timings.map(e=>e.time)).toFixed(2)} ms</pre>`,e+="</br>";let a=timings.filter(e=>"top"==e.type).map(e=>e.time),o=timings.filter(e=>"right"==e.type).map(e=>e.time),i=timings.filter(e=>"left"==e.type).map(e=>e.time),s=timings.filter(e=>"guardbreak"==e.type).map(e=>e.time);if(a.length>0){let t;e+=`<pre>Attempts (top) <span>....................</span> : ${a.length}</pre>`,e+=`<pre>Faster than 400 ms (top) <span>..........</span> : ${a.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (top) <span>..........</span> : ${a.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (top) <span>..........</span> : ${a.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (top) <span>.......</span> : ${(a.reduce((e,t)=>e+t)/a.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (top) <span>.......</span> : ${t=a.length%2==0?((a.sort()[a.length/2-1]+a.sort()[a.length/2])/2).toFixed(2):a.sort()[(a.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (top) <span>.......</span> : ${Math.min(...a).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (top) <span>.......</span> : ${Math.max(...a).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (top) <span>....................</span> :</pre>",e+="<pre>Faster than 400 ms (top) <span>..........</span> :</pre>",e+="<pre>Faster than 500 ms (top) <span>..........</span> :</pre>",e+="<pre>Faster than 600 ms (top) <span>..........</span> :</pre>",e+="<pre>Average reaction time (top) <span>.......</span> :</pre>",e+="<pre>Median  reaction time (top) <span>.......</span> :</pre>",e+="<pre>Fastest reaction time (top) <span>.......</span> :</pre>",e+="<pre>Slowest reaction time (top) <span>.......</span> :</pre>";if(e+="</br>",o.length>0){let t;e+=`<pre>Attempts (right) <span>..................</span> : ${o.length}</pre>`,e+=`<pre>Faster than 400 ms (right) <span>........</span> : ${o.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (right) <span>........</span> : ${o.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (right) <span>........</span> : ${o.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (right) <span>.....</span> : ${(o.reduce((e,t)=>e+t)/o.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (right) <span>.....</span> : ${t=o.length%2==0?((o.sort()[o.length/2-1]+o.sort()[o.length/2])/2).toFixed(2):o.sort()[(o.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (right) <span>.....</span> : ${Math.min(...o).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (right) <span>.....</span> : ${Math.max(...o).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (right) <span>..................</span> :</pre>",e+="<pre>Faster than 400 ms (right) <span>........</span> :</pre>",e+="<pre>Faster than 500 ms (right) <span>........</span> :</pre>",e+="<pre>Faster than 600 ms (right) <span>........</span> :</pre>",e+="<pre>Average reaction time (right) <span>.....</span> :</pre>",e+="<pre>Median  reaction time (right) <span>.....</span> :</pre>",e+="<pre>Fastest reaction time (right) <span>.....</span> :</pre>",e+="<pre>Slowest reaction time (right) <span>.....</span> :</pre>";if(e+="</br>",i.length>0){let t;e+=`<pre>Attempts (left) <span>...................</span> : ${i.length}</pre>`,e+=`<pre>Faster than 400 ms (left) <span>.........</span> : ${i.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (left) <span>.........</span> : ${i.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (left) <span>.........</span> : ${i.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (left) <span>......</span> : ${(i.reduce((e,t)=>e+t)/i.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (left) <span>......</span> : ${t=i.length%2==0?((i.sort()[i.length/2-1]+i.sort()[i.length/2])/2).toFixed(2):i.sort()[(i.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (left) <span>......</span> : ${Math.min(...i).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (left) <span>......</span> : ${Math.max(...i).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (left) <span>...................</span> :</pre>",e+="<pre>Faster than 400 ms (left) <span>.........</span> :</pre>",e+="<pre>Faster than 500 ms (left) <span>.........</span> :</pre>",e+="<pre>Faster than 600 ms (left) <span>.........</span> :</pre>",e+="<pre>Average reaction time (left) <span>......</span> :</pre>",e+="<pre>Median  reaction time (left) <span>......</span> :</pre>",e+="<pre>Fastest reaction time (left) <span>......</span> :</pre>",e+="<pre>Slowest reaction time (left) <span>......</span> :</pre>";if(e+="</br>",s.length>0){let t;e+=`<pre>Attempts (guard break) <span>............</span> : ${s.length}</pre>`,e+=`<pre>Faster than 400 ms (guard break) <span>..</span> : ${s.filter(e=>e<400).length}</pre>`,e+=`<pre>Faster than 500 ms (guard break) <span>..</span> : ${s.filter(e=>e<500).length}</pre>`,e+=`<pre>Faster than 600 ms (guard break) <span>..</span> : ${s.filter(e=>e<600).length}</pre>`,e+=`<pre>Average reaction time (guard break) : ${(s.reduce((e,t)=>e+t)/s.length).toFixed(2)} ms</pre>`,e+=`<pre>Median  reaction time (guard break) : ${t=s.length%2==0?((s.sort()[s.length/2-1]+s.sort()[s.length/2])/2).toFixed(2):s.sort()[(s.length-1)/2].toFixed(2)} ms</pre>`,e+=`<pre>Fastest reaction time (guard break) : ${Math.min(...s).toFixed(2)} ms</pre>`,e+=`<pre>Slowest reaction time (guard break) : ${Math.max(...s).toFixed(2)} ms</pre>`}else e+="<pre>Attempts (guard break) <span>............</span> :</pre>",e+="<pre>Faster than 400 ms (guard break) <span>..</span> :</pre>",e+="<pre>Faster than 500 ms (guard break) <span>..</span> :</pre>",e+="<pre>Faster than 600 ms (guard break) <span>..</span> :</pre>",e+="<pre>Average reaction time (guard break) :</pre>",e+="<pre>Median  reaction time (guard break) :</pre>",e+="<pre>Fastest reaction time (guard break) :</pre>",e+="<pre>Slowest reaction time (guard break) :</pre>";n.innerHTML=e}function start(){null!==gbButton&&void 0!==gbButton&&("gamepad"!==input||null!==axisX&&void 0!==axisX&&null!==axisY&&null!==axisY)?(setConfigs(),hidePaused(),paused=!1):showMessage("You need to configure your gamepad first.")}function resetInputs(){gbButton=null,axisX=null,axisY=null}function showInputSelect(){document.getElementById("input-select").style.visibility="visible"}function hideInputSelect(){document.getElementById("input-select").style.visibility="hidden"}function setInput(e){input=e,setInputConfigOptions(),hideInputSelect()}const tick=1e3/60;let delta,t0,input,gamepad,axisX,axisY,key,mouseX,mouseY,gbButton,angleTop,angleBottom,angleSide,deadzoneGamepad,deadzoneUp,deadzoneSide,deadzoneBottom,paused=!1;const minTimerMs=400,maxTimerMs=5e3;let timer,reaction,attack,defense,timings=[],messages=[];window.onload=function(){delta=0,t0=performance.now(),requestAnimationFrame(loop),paused=!0},window.addEventListener("gamepadconnected",e=>{console.log(`${e.gamepad.id} connected!`)}),window.addEventListener("gamepaddisconnected",e=>{console.log(`${e.gamepad.id} disconnected!`)}),window.addEventListener("keydown",e=>{key=e.code}),window.addEventListener("keyup",e=>{key=null}),document.getElementById("guard").addEventListener("mousedown",e=>{key=e.button}),document.getElementById("guard").addEventListener("mouseup",e=>{key=null}),document.getElementById("guard").addEventListener("mousemove",e=>{let t=document.getElementById("guard").getBoundingClientRect();mouseX=Math.round(e.clientX-t.left-t.right/2),mouseY=Math.round(e.clientY-t.top-(t.bottom-t.top)/2)});